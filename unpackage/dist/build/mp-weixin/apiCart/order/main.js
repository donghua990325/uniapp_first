(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["apiCart/order/main"],{"0f54":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(a("a34a")),i=a("de50"),r=a("26b0");function o(t){return t&&t.__esModule?t:{default:t}}function s(t,e,a,n,i,r,o){try{var s=t[r](o),d=s.value}catch(u){return void a(u)}s.done?e(d):Promise.resolve(d).then(n,i)}function d(t){return function(){var e=this,a=arguments;return new Promise((function(n,i){var r=t.apply(e,a);function o(t){s(r,n,i,o,d,"next",t)}function d(t){s(r,n,i,o,d,"throw",t)}o(void 0)}))}}var u={onLoad:function(t){this.ral=t.ral,this.super=t.super,this.pintuan=t.pintuan,this.spike=t.spike,this.goods_id=t.goods_id},onShow:function(){(0,r.toLogin)(),t.getStorageSync("addressId")&&(this.addressId=t.getStorageSync("addressId")),t.getStorageSync("shipping")&&(this.shipping=t.getStorageSync("shipping")),t.getStorageSync("package")?this.package=t.getStorageSync("package"):this.package.pack_fee=0,t.getStorageSync("delivery")&&(this.delivery=t.getStorageSync("delivery")),t.getStorageSync("shipping_id")&&(this.shipping_id=t.getStorageSync("shipping_id"),console.log(this.shipping_id),this.shipping_type=t.getStorageSync("shipping_type")),t.getStorageSync("tax_type_name")&&(this.tax_type=t.getStorageSync("tax_type"),this.tax_type_name=t.getStorageSync("tax_type_name"),this.tax_title=t.getStorageSync("tax_name"),this.tax_num=t.getStorageSync("tax_num")),t.getStorageSync("productId")&&(this.productId=t.getStorageSync("productId")),t.getStorageSync("number")&&(this.number=t.getStorageSync("number")),t.getStorageSync("bonusName")&&(this.bonusName=t.getStorageSync("bonusName"),this.bonus_id=t.getStorageSync("bonus_id"),this.type_money=t.getStorageSync("bonusMoney")),t.getStorageSync("point")&&(this.user_point=t.getStorageSync("point")),t.getStorageSync("p_type")&&(this.p_type=t.getStorageSync("p_type")),t.getStorageSync("k_status")&&(this.k_status=t.getStorageSync("k_status")),t.getStorageSync("delivery_name")&&(this.delivery_name=t.getStorageSync("delivery_name")),t.getStorageInfoSync("delivery_id"),this.ral=this.ral,this.superpack=this.super,this.pintuan=this.pintuan,this.result_spike=this.spike,this.goods_id=this.goods_id,this.getDetail(),this.getOrder_end()},onUnload:function(){t.removeStorage({key:"addressId"}),t.removeStorage({key:"shipping"}),t.removeStorage({key:"package"}),t.removeStorage({key:"p_type"}),t.removeStorage({key:"k_status"}),t.removeStorage({key:"integralGoodsid"}),t.removeStorage({key:"delivery"}),t.removeStorage({key:"goods_status"}),t.removeStorage({key:"delivery_name"}),t.removeStorage({key:"productId"}),t.removeStorage({key:"number"})},created:function(){},mounted:function(){},data:function(){return{addressId:"",costItem:"",finalAmount:"",totalAmount:"",pmtOrder:0,pmtAmount:0,point:0,listData:[],address:{},shipping:[],package:[],delivery:[],productId:"",shipping_id:"",k_status:"",number:"",money:"",bonus:[],bonusName:"",bonus_id:"",pay_app_id:"",tax_type_name:"",tax_type:"n",tax:0,tax_title:"",tax_num:"",max_integral:0,user_point:0,discount:0,size:!1,end_status:"",end_time:"",prompt:"",delivery_name:"",type_money:0,superpack:"false",result_spike:"false",goods_id:"",pintuan:"false",ral:!1,textarea:!0,msg:"",jifennum:"",consignee:"",modalName:null,radio:"",list:[],d_id:" ",dtype:!1,dt:[],dtchecked:0}},components:{},methods:{SetSize:function(t){this.size=t.detail.value},pay:function(){var e=this;return d(n.default.mark((function a(){var r,o;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(void 0!=e.addressId){a.next=3;break}return t.showToast({icon:"none",title:"请选择收货地址"}),a.abrupt("return",!1);case 3:if(0!==e.shipping.length){a.next=9;break}return"",t.showToast({title:"请选择配送方式",duration:2e3,icon:"none",mask:!0,success:function(t){}}),a.abrupt("return",!1);case 9:JSON.stringify(e.shipping);case 10:if(""!=e.tax_type){a.next=13;break}return t.showToast({title:"请选择是否开取发票",duration:2e3,icon:"none",mask:!0,success:function(t){}}),a.abrupt("return",!1);case 13:if(r=/^(0|[1-9][0-9]*)$/,r.test(e.point)){a.next=17;break}return t.showToast({title:"积分只能为大于0的整数",duration:2e3,icon:"none",mask:!0,success:function(t){setTimeout((function(){this.point=0}),10)}}),a.abrupt("return",!1);case 17:if(!(e.point>Number(e.user_point))){a.next=20;break}return t.showToast({title:"用户积分不足",duration:2e3,icon:"none",mask:!0,success:function(t){e.point=0}}),a.abrupt("return",!1);case 20:if(!(e.point>e.max_integral)){a.next=23;break}return t.showToast({title:"请填写正确的积分数",duration:2e3,icon:"none",mask:!0,success:function(t){}}),a.abrupt("return",!1);case 23:if("succ"!=e.end_status){a.next=27;break}if(0!=e.size){a.next=27;break}return t.showToast({title:"请同意明天配送",duration:2e3,icon:"none",mask:!0,success:function(t){}}),a.abrupt("return",!1);case 27:return e.pay_app_id="wxpaywxapp",void 0==e.ral&&(e.ral=!1),void 0==e.superpack&&(e.superpack=!1),a.next=32,(0,i.orderSaveCartApi)({address_id:e.addressId,shipping_id:e.shipping_id,productId:e.productId,bonus_id:e.bonus_id,point:e.point,p_type:e.p_type,o_time:e.delivery.o_time,inv_payee:e.tax_title,tax:e.tax,tax_type:e.tax_type,tax_num:e.tax_num,ral:e.ral,superpack:e.superpack,superGoodsid:e.superGoodsid,integralGoodsid:e.integralGoodsid,pack_fee:e.package.pack_fee,pack_name:e.package.pack_name,inv_type:e.tax_type_name,result_spike:e.result_spike,goods_id:e.goods_id,delivery_name:t.getStorageSync("delivery_name"),delivery_id:t.getStorageSync("delivery_id"),pintuan:e.pintuan,pintuanGoodsId:e.pintuanGoodsId,pintuanNumber:e.number,pintuanOrderId:e.pintuanOrderId,msg:e.msg,jifennum:t.getStorageSync("jifennum")});case 32:o=a.sent,o.data.gen_order?(t.setStorageSync("bonusName",""),t.setStorageSync("bonus_id",""),t.setStorageSync("orderId",o.data.info.order_id),t.navigateTo({url:"/apiCart/pay/main?orderId="+o.data.info.order_id})):t.showToast({title:o.data.info,icon:"none",duration:2e3});case 34:case"end":return a.stop()}}),a)})))()},toBonus:function(){t.navigateTo({url:"/apiMember/coupon/main?order=y&money="+this.costItem})},toOrderpackage:function(){"true"==this.ral?t.navigateTo({url:"/apiCart/orderpackage/main?ral=true"}):"true"==this.superpack?t.navigateTo({url:"/apiCart/orderpackage/main?superpack=true"}):t.navigateTo({url:"/apiCart/orderpackage/main"})},toOrderTiem:function(){"true"==this.ral?t.navigateTo({url:"/apiCart/deliveryTime/main?ral=true"}):"true"==this.superpack?t.navigateTo({url:"/apiCart/deliveryTime/main?superpack=true"}):t.navigateTo({url:"/apiCart/deliveryTime/main"})},toAddressList:function(){t.navigateTo({url:"/apiCart/addressselect/main"})},toAdd:function(){t.navigateTo({url:"/apiCart/address/main?type=buy"})},toCoupon:function(){t.navigateTo({url:"/apiMember/coupon/main"})},toTax:function(){if(void 0==this.addressId)return t.showToast({title:"没有选择收货地址",icon:"none",duration:2e3}),!1;t.navigateTo({url:"/apiCart/tax/main"})},toOrderdelivery:function(){if(void 0==this.addressId)return t.showToast({title:"没有选择收货地址",icon:"none",duration:2e3}),!1;"true"==this.ral?t.navigateTo({url:"/apiCart/orderdelivery/main?ral=true"}):"true"==this.superpack?t.navigateTo({url:"/apiCart/orderdelivery/main?superpack=true"}):this.tagVal(0,"1",!0,"1")},tagVal:function(e,a){var r=arguments,o=this;return d(n.default.mark((function s(){var d,u,p,c,l;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return d=!(r.length>2&&void 0!==r[2])||r[2],u=r.length>3?r[3]:void 0,p=o.dtchecked==e,o.dtchecked=e,n.next=6,(0,i.shippingListBottomApi)({delivery_name:o.delivery_name,delivery_id:a});case 6:if(c=n.sent,o.type=u,t.setStorageSync("delivery_id",a),o.list=c.data,"0"==o.type&&(d&&(o.modalName="RadioModal"),p?0==o.list&&(o.modalName=null,o.p_status=!1):o.list?(t.setStorageSync("p_type",o.list[0].type),t.setStorageSync("k_status",o.list[0].k_status),o.p_status="true"):(o.modalName=null,o.p_status=!1),t.setStorageSync("shipping_type","b")),void 0==o.type&&" "==o.delivery_name&&(o.delivery_name=o.list[0].delivery_name,o.d_id=o.list[0].parent_id,o.radio="radio0"),"1"!=o.type){n.next=28;break}return n.next=15,(0,i.shippingListTopApi)({address_id:o.addressId});case 15:if(l=n.sent,o.modalName="RadioModal",o.list=l.data.info,0!==o.list.length){n.next=22;break}return o.modalName="",t.showToast({title:"该配送方式没有下级请选择别的方式配送",icon:"none",duration:1500}),n.abrupt("return",!1);case 22:o.delivery_name=o.list[0].delivery_name,o.d_id=o.list[0].delivery_id,o.p_status="true",o.dtype=!0,o.radio="radio0",t.setStorageSync("shipping_type","a");case 28:case"end":return n.stop()}}),s)})))()},RadioChange:function(t){console.log(456456,t),this.radio=t.detail.value},name:function(t){console.log(1111112346),this.delivery_name=t},clickId:function(e,a,n,i,r,o){console.log(77777895555),t.setStorageSync("shipping_id",e),t.setStorageSync("p_type",a),void 0==a&&t.setStorageSync("p_type",!0),t.setStorageSync("k_status",n),this.delivery_name=i,console.log(789789,this.delivery_name),this.d_id=r,this.modalName=" ",this.dtype=!1,void 0==o&&(this.dtype=!0),this.getDeliverylist()},startOrder:function(){var e=this;return d(n.default.mark((function a(){return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(""===t.getStorageSync("shipping")&&(console.log(e.list[0].delivery_id,e.dt[0].shipping_id),t.setStorageSync("shipping_id",e.list[0].delivery_id)),t.setStorageSync("k_status",""),e.shipping={id:e.dt[0].shipping_id,dt_name:e.dt[0].shipping_name,has_cod:e.dt[0].support_cod,is_protect:"N"},console.log(e.shipping,"46546fdsfdsfsdfsf"),t.setStorageSync("shipping",e.shipping),0!=e.p_status){a.next=8;break}return t.showToast({title:"该配送方式没有配送地点，请选择其他配送方式",duration:2e3,icon:"none",mask:!0}),a.abrupt("return",!1);case 8:if(0!=e.goods_status){a.next=12;break}if("1"!=e.type){a.next=12;break}return t.showToast({title:"订单中存在，不允许快递配送的商品，请选择其他配送方式",duration:2e3,icon:"none",mask:!0}),a.abrupt("return",!1);case 12:if(" "!=e.delivery_name){a.next=15;break}return t.showToast({title:"请选择配送地点",duration:2e3,icon:"none",mask:!0}),a.abrupt("return",!1);case 15:case"end":return a.stop()}}),a)})))()},getDeliverylist:function(){var e=this;return d(n.default.mark((function a(){var r;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,(0,i.shippingListApi)({address_id:e.addressId});case 2:r=a.sent,r&&(e.dt=r.data.info,console.log(111,e.dt),e.startOrder(),e.type=r.data.info[0]["type"]),t.getStorageSync("shipping")&&(e.shipping=t.getStorageSync("shipping"),Object.values(e.dt).forEach((function(t,e){})));case 5:case"end":return a.stop()}}),a)})))()},getDetail:function(){var e=this;return d(n.default.mark((function a(){var r;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return 0===e.shipping.length?"":JSON.stringify(e.shipping),e.shipping.id&&(e.shipping_id=e.shipping.id),"n"===e.tax_type&&(e.tax_type="n"),"true"==e.ral&&(e.integralGoodsid=t.getStorageSync("integralGoodsid")),"true"==e.superpack&&(e.superGoodsid=t.getStorageSync("superGoodsid")),void 0==e.p_type&&(e.p_type="true"),"true"==e.pintuan&&(e.productId=t.getStorageSync("pt_product_id"),e.number=t.getStorageSync("pt_num"),e.pintuanGoodsId=t.getStorageSync("pt_goods_id"),e.pintuanOrderId=t.getStorageSync("pt_order_id")),a.next=9,(0,i.orderDetailListApi)({address_id:e.addressId,productId:e.productId,number:e.number,shipping:e.shippingData,ral:e.ral,super:e.superpack,integralGoodsid:e.integralGoodsid,superGoodsid:e.superGoodsid,shipping_id:e.shipping_id,p_type:e.p_type,tax_type:e.tax_type,shipping_type:e.shipping_type,pintuan:e.pintuan,pintuanGoodsId:e.pintuanGoodsId,result_spike:e.result_spike,goods_id:e.goods_id,jifennum:t.getStorageSync("jifennum")});case 9:if(r=a.sent,console.log(111,r),!1===r.data.info&&t.switchTab({url:"/pages/my/main"}),0!=r.data.cart_init){a.next=15;break}return t.showToast({icon:"none",title:r.data.info,success:function(){setTimeout((function(){t.switchTab({url:"/pages/my/main"})}),1e3)}}),a.abrupt("return",!1);case 15:"true"!=e.ral&&"true"!=e.superpack&&e.getDiscount(),r&&(e.costItem=r.data.info.total.goods_amount,e.finalAmount=r.data.info.total.total_fee,e.totalAmount=r.data.info.total.total_fee,e.max_integral=r.data.info.total.integral,r.data.info.total.pmtOrder&&(e.pmtOrder=r.pmtOrder),r.data.info.total.pmtAmount&&(e.pmtAmount=r.pmtAmount),e.listData=r.data.info.goods_list,e.money=r.data.info.total.shipping_fee,t.setStorageSync("goods_status",r.data.info.total.goods_status),e.tax=r.data.info.total.tax,e.address=r.data.info.address_list,e.addressId=r.data.info.address_list.address_id,e.finalAmount=e.finalAmount-e.type_money,t.setStorageSync("addressId",r.data.info.address_list.address_id),e.package&&(e.costItem<e.package.free_money&&(e.finalAmount=Number(e.finalAmount)+Number(e.package.pack_fee)),"true"==e.superpack&&(e.costItem=r.data.info.total.goods_price,e.money=r.data.info.total.shipping_fee,e.finalAmount=e.finalAmount+Number(e.package.pack_fee)),"true"==e.ral&&(e.finalAmount=e.finalAmount-e.discount-r.data.info.total.goods_price+Number(e.package.pack_fee))));case 17:case"end":return a.stop()}}),a)})))()},getDiscount:function(){var t=this;return d(n.default.mark((function e(){var a;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return"true"==t.pintuan&&(t.goods_id=t.pintuanGoodsId),e.next=3,(0,i.getDiscountApi)({product_id:t.productId,result_spike:t.result_spike,goods_id:t.goods_id});case 3:a=e.sent,a.data.discount&&(t.discount=a.data.discount),t.discount>0&&(t.finalAmount=t.finalAmount-t.discount);case 6:case"end":return e.stop()}}),e)})))()},getOrder_end:function(){var t=this;return d(n.default.mark((function e(){var a;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,i.getOrderEndApi)({});case 2:a=e.sent,"fail"==a.data.status?t.end_status=a.data.status:(t.end_status=a.data.status,t.end_time=a.data.response.end_time,t.prompt=a.data.response.prompt);case 4:case"end":return e.stop()}}),e)})))()}}};e.default=u}).call(this,a("543d")["default"])},"1cac":function(t,e,a){"use strict";var n=a("2135"),i=a.n(n);i.a},2135:function(t,e,a){},"70a2":function(t,e,a){"use strict";a.r(e);var n=a("dffb"),i=a("ec0b");for(var r in i)"default"!==r&&function(t){a.d(e,t,(function(){return i[t]}))}(r);a("1cac");var o,s=a("f0c5"),d=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"226aaa26",null,!1,n["a"],o);e["default"]=d.exports},dffb:function(t,e,a){"use strict";var n;a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return n}));var i=function(){var t=this,e=t.$createElement,a=(t._self._c,t._f("priceFormat")(t.money,2)),n=t._f("priceFormat")(t.finalAmount,2);t.$mp.data=Object.assign({},{$root:{f0:a,f1:n}})},r=[]},ec0b:function(t,e,a){"use strict";a.r(e);var n=a("0f54"),i=a.n(n);for(var r in n)"default"!==r&&function(t){a.d(e,t,(function(){return n[t]}))}(r);e["default"]=i.a},f475:function(t,e,a){"use strict";(function(t){a("a2bf");n(a("66fd"));var e=n(a("70a2"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])}},[["f475","common/runtime","common/vendor"]]]);